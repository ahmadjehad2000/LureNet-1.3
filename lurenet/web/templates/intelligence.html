{% extends "base.html" %}

{% block title %}Threat Intelligence - LureNet{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Threat Intelligence Analysis</h1>
    <p class="page-subtitle">Analyze hashes, URLs, and files against threat intelligence databases</p>
</div>

<div class="grid-2">
    <!-- Hash Analysis -->
    <div class="card">
        <div class="card-header">
            <h3>Hash Analysis</h3>
            <p class="text-muted">Check MD5, SHA1, or SHA256 hashes against threat databases</p>
        </div>
        <div class="card-body">
            <form id="hashAnalysisForm" accept-charset="UTF-8">
                <div class="form-group">
                    <label for="hashInput" class="form-label">File Hash</label>
                    <input
                        type="text"
                        id="hashInput"
                        name="hash"
                        class="form-input"
                        placeholder="Enter MD5, SHA1, or SHA256 hash"
                        required
                    >
                </div>
                <button type="submit" class="btn btn-primary">Analyze Hash</button>
            </form>
            <div id="hashResults" style="margin-top: 1.5rem; display: none;"></div>
        </div>
    </div>

    <!-- URL Analysis -->
    <div class="card">
        <div class="card-header">
            <h3>URL Analysis</h3>
            <p class="text-muted">Scan URLs for malicious content</p>
        </div>
        <div class="card-body">
            <form id="urlAnalysisForm" accept-charset="UTF-8">
                <div class="form-group">
                    <label for="urlInput" class="form-label">URL</label>
                    <input
                        type="url"
                        id="urlInput"
                        name="url"
                        class="form-input"
                        placeholder="https://example.com"
                        required
                    >
                </div>
                <button type="submit" class="btn btn-primary">Analyze URL</button>
            </form>
            <div id="urlResults" style="margin-top: 1.5rem; display: none;"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.getElementById('hashAnalysisForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const hash = document.getElementById('hashInput').value.trim();
        const resultsDiv = document.getElementById('hashResults');
        resultsDiv.innerHTML = '<div class="loading">Analyzing...</div>';
        resultsDiv.style.display = 'block';

        try {
            const response = await fetch('/api/intel/hash', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json; charset=UTF-8' },
                body: JSON.stringify({ hash })
            });
            const data = await response.json();
            resultsDiv.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        } catch (error) {
            resultsDiv.innerHTML = '<div class="text-error">Error: ' + error.message + '</div>';
        }
    });

    document.getElementById('urlAnalysisForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const url = document.getElementById('urlInput').value.trim();
        const resultsDiv = document.getElementById('urlResults');
        resultsDiv.innerHTML = '<div class="loading">Analyzing...</div>';
        resultsDiv.style.display = 'block';

        try {
            const response = await fetch('/api/intel/url', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json; charset=UTF-8' },
                body: JSON.stringify({ url })
            });
            const data = await response.json();
            resultsDiv.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        } catch (error) {
            resultsDiv.innerHTML = '<div class="text-error">Error: ' + error.message + '</div>';
        }
    });
</script>
{% endblock %}
