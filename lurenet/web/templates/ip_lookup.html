{% extends "base.html" %}

{% block title %}IP Lookup - LureNet{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">IP Address Lookup</h1>
    <p class="page-subtitle">Geo-location and reputation analysis for IP addresses</p>
</div>

<div class="grid-2">
    <!-- IP Lookup -->
    <div class="card">
        <div class="card-header">
            <h3>Lookup IP Address</h3>
            <p class="text-muted">Get geo-location and threat intelligence for any IP</p>
        </div>
        <div class="card-body">
            <form id="ipLookupForm" accept-charset="UTF-8">
                <div class="form-group">
                    <label for="ipInput" class="form-label">IP Address</label>
                    <input
                        type="text"
                        id="ipInput"
                        name="ip"
                        class="form-input"
                        placeholder="192.168.1.1 or 2001:db8::1"
                        required
                        pattern="^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$|^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$"
                    >
                </div>
                <button type="submit" class="btn btn-primary">Lookup IP</button>
            </form>
            <div id="ipResults" style="margin-top: 1.5rem; display: none;"></div>
        </div>
    </div>

    <!-- Attacker IPs -->
    <div class="card">
        <div class="card-header">
            <h3>Recent Attacker IPs</h3>
            <p class="text-muted">IPs detected by honeypot</p>
        </div>
        <div class="card-body">
            <div id="attackerIPs">Loading...</div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Load attacker IPs
    async function loadAttackerIPs() {
        try {
            const response = await fetch('/api/attacker/ips');
            const data = await response.json();
            const ipsDiv = document.getElementById('attackerIPs');

            if (data.ips && data.ips.length > 0) {
                ipsDiv.innerHTML = '<div class="ip-list">' +
                    data.ips.map(ip => `<div class="ip-item" onclick="lookupIP('${ip}')"><code>${ip}</code></div>`).join('') +
                    '</div>';
            } else {
                ipsDiv.innerHTML = '<p class="text-muted">No attacker IPs detected yet</p>';
            }
        } catch (error) {
            document.getElementById('attackerIPs').innerHTML = '<div class="text-error">Error: ' + error.message + '</div>';
        }
    }

    // Lookup IP
    function lookupIP(ip) {
        document.getElementById('ipInput').value = ip;
        document.getElementById('ipLookupForm').dispatchEvent(new Event('submit'));
    }

    document.getElementById('ipLookupForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const ip = document.getElementById('ipInput').value.trim();
        const resultsDiv = document.getElementById('ipResults');

        resultsDiv.innerHTML = '<div class="loading">Looking up IP...</div>';
        resultsDiv.style.display = 'block';

        try {
            const response = await fetch('/api/ip/lookup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json; charset=UTF-8' },
                body: JSON.stringify({ ip })
            });
            const data = await response.json();
            resultsDiv.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        } catch (error) {
            resultsDiv.innerHTML = '<div class="text-error">Error: ' + error.message + '</div>';
        }
    });

    loadAttackerIPs();
</script>

<style>
.ip-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.ip-item {
    cursor: pointer;
    padding: 0.5rem 1rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    transition: all var(--transition-base);
}

.ip-item:hover {
    background: var(--bg-hover);
    border-color: var(--primary);
    transform: translateY(-2px);
}
</style>
{% endblock %}
