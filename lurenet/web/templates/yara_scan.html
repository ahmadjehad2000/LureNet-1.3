{% extends "base.html" %}

{% block title %}YARA Scanner - LureNet{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">YARA Malware Scanner</h1>
    <p class="page-subtitle">Scan data and files using YARA rules for malware detection</p>
</div>

<div class="card">
    <div class="card-header">
        <h3>Scan Data with YARA</h3>
    </div>
    <div class="card-body">
        <form id="yaraScanForm" accept-charset="UTF-8">
            <div class="form-group">
                <label for="dataInput" class="form-label">Data to Scan</label>
                <textarea
                    id="dataInput"
                    name="data"
                    class="form-input"
                    rows="10"
                    placeholder="Paste suspicious code, strings, or data here..."
                    required
                ></textarea>
            </div>
            <div class="form-group">
                <label for="nameInput" class="form-label">Sample Name (optional)</label>
                <input
                    type="text"
                    id="nameInput"
                    name="name"
                    class="form-input"
                    placeholder="sample.txt"
                >
            </div>
            <button type="submit" class="btn btn-primary">Scan with YARA</button>
        </form>
        <div id="scanResults" style="margin-top: 1.5rem; display: none;"></div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Loaded YARA Rules</h3>
    </div>
    <div class="card-body">
        <div id="rulesInfo">Loading rules information...</div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Load YARA rules info
    async function loadRulesInfo() {
        try {
            const response = await fetch('/api/yara/info');
            const data = await response.json();
            document.getElementById('rulesInfo').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        } catch (error) {
            document.getElementById('rulesInfo').innerHTML = '<div class="text-error">Error loading rules: ' + error.message + '</div>';
        }
    }

    // YARA scan
    document.getElementById('yaraScanForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const data = document.getElementById('dataInput').value;
        const name = document.getElementById('nameInput').value || 'input';
        const resultsDiv = document.getElementById('scanResults');

        resultsDiv.innerHTML = '<div class="loading">Scanning with YARA...</div>';
        resultsDiv.style.display = 'block';

        try {
            const response = await fetch('/api/yara/scan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json; charset=UTF-8' },
                body: JSON.stringify({ data, name })
            });
            const result = await response.json();
            resultsDiv.innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
        } catch (error) {
            resultsDiv.innerHTML = '<div class="text-error">Error: ' + error.message + '</div>';
        }
    });

    loadRulesInfo();
</script>
{% endblock %}
